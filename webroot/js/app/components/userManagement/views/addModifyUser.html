<ul class="breadcrumb panel-breadcrumb">
    <li>
        <a ui-sref="DataAdmin.home">
            <i class="fa fa-home"></i>
        </a>
    </li>
    <li>{{$root.currentDatabase.name}}</li>
    <li><a ui-sref="DataAdmin.home.userManagement">User Management</a></li>
    <li class="breadcrumb-active" ng-if="!modifyUser">Add User</li>
    <li class="breadcrumb-active" ng-if="modifyUser">Modify User</li>
</ul>

<div class="page-header">
    <h2>Users</h2>
    <div class="toolbar">
        <a ui-sref="DataAdmin.home.userManagement" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"><i class="fa kd-back"></i></a>
    </div>
</div>

<div class="wrapper ng-scope" ng-app="openEmis">

    <div class="panel">
        <div class="panel-body">
            <form class="form-horizontal" name="addModifyUser" method="post" ng-submit="addModifyUser.$valid && userDetails.roles.length > 0&& emailInvalid != true && saveUser(userDetails)" novalidate>
                <div class="input string required">
                    <label for="users-username">Name</label>
                    <div class="suggestionbox" dropdown auto-close="disabled" is-open="showNameSuggestion" style="width: 30%; position: relative; float: left;">
                        <input type="text" style="width: 100%; margin-bottom: 0px;" name="userName" ng-model="userDetails.name" ng-focus="showNameSuggestion = true;" ng-blur="onBlur('Name')" required>
                        <ul class="dropdown-menu" role="menu" style=" max-height: 200px; overflow-y: auto; width: 100%;">
                            <li ng-repeat="user in suggestionUsersList | filter: {name: userDetails.name}">
                                <a href="javascript:void(0)" ng-click="autoSuggestionSelected(user)">{{user.name}}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="error-message" ng-show="addModifyUser.$submitted || addModifyUser.userName.$touched">
                        <span ng-show="addModifyUser.userName.$error.required">Name is required.</span>
                    </div>
                </div>

                <div class="input string required">
                    <label for="users-first-name">Email</label>

                    <div class="suggestionbox" dropdown auto-close="disabled" is-open="showEmailSuggestion" style="width: 30%; position: relative; float: left;">
                        <input type="text" style="width: 100%; margin-bottom: 0px;" name="userEmail" ng-model="userDetails.email" ng-focus="showEmailSuggestion = true;" ng-blur="onBlur('Email')" required>
                        <ul class="dropdown-menu" role="menu" style=" max-height: 200px; overflow-y: auto; width: 100%;">
                            <li ng-repeat="user in suggestionUsersList | filter: {name: userDetails.email}">
                                <a href="javascript:void(0)" ng-click="autoSuggestionSelected(user)">{{user.email}}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="error-message" ng-show="addModifyUser.$submitted || addModifyUser.userEmail.$touched">
                        <span ng-show="addModifyUser.userEmail.$error.required">Email is required.</span>
                        <span ng-show="emailInvalid == true">Email Address is invalid.</span>
                    </div>
                </div>

                <div class="input">
                    <label for="users-last-name">Roles</label>
                    <div class="input-checkbox">
                        <div class="input">
                            <input type="checkbox" style="margin: 0;" ng-disabled="userDetails.roles.indexOf('TEMPLATE') >= 0 || userDetails.roles.indexOf('DATAENTRY') >= 0" ng-click="roleClicked('ADMIN')" ng-checked="userDetails.roles.indexOf('ADMIN') >= 0">
                            <label class="checkbox-label">Admin</label>
                        </div>
                        <div class="input">
                            <input type="checkbox" style="margin: 0;" ng-disabled="userDetails.roles.indexOf('ADMIN') >= 0" ng-click="roleClicked('TEMPLATE')" ng-checked="userDetails.roles.indexOf('TEMPLATE') >= 0">
                            <label class="checkbox-label">Template</label>
                        </div>
                        <div class="input">
                            <input type="checkbox" style="margin: 0;" ng-disabled="userDetails.roles.indexOf('ADMIN') >= 0" ng-click="roleClicked('DATAENTRY')" ng-checked="userDetails.roles.indexOf('DATAENTRY') >= 0">
                            <label class="checkbox-label">Data Entry</label>
                            <div ng-show="userDetails.roles.indexOf('DATAENTRY') >= 0" class="table-responsive" style="padding-left: 20px; padding-top: 10px">
                                <table class="table table-striped table-hover table-bordered">
                                    <thead>
                                    <tr>
                                        <th>Access Type</th>
                                        <th>Access</th>
                                        <th>Action</th>
                                    </tr>
						            </thead>
                                    <tbody>
                                    <tr>
                                        <td>
                                            Indicator
                                        </td>
                                        <td>
                                            <span ng-if="userDetails.access.indicator.length <= 0">All</span>
                                            <span ng-if="userDetails.access.indicator.length > 0">Multiple</span>
                                        </td>
                                        <td>
                                            <a ng-click="openIndicatorAccess()" class="btn btn-dropdown action-toggle btn-single-action">
                                                Select
                                            </a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Area</td>
                                        <td>
                                            <span ng-if="userDetails.access.area.length <= 0">All</span>
                                            <span ng-if="userDetails.access.area.length > 0">Multiple</span>
                                        </td>
                                        <td>
                                            <a ng-click="openAreaAccess()" class="btn btn-dropdown action-toggle btn-single-action">
                                                Select
                                            </a>
                                        </td>
                                    </tr>
						            </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="error-message" ng-show="addModifyUser.$submitted">
                        <span class="error" ng-show="userDetails.roles.length <= 0">*Atleast one role should be selected.</span>
                    </div>
                </div>

                <div class="input" ng-if="!modifyUser">
                    <input type="checkbox" ng-model="createAnother.checked">
                    <label class="checkbox-label">Create Another User</label>
                </div>

                <div class="form-buttons">
                    <div class="button-label"></div>
                    <button class="btn btn-default btn-save" type="submit"><i class="fa fa-check"></i> Save</button>
                    <a ui-sref="DataAdmin.home.userManagement" class="btn btn-outline btn-cancel"><i class="fa fa-close"></i> Cancel</a>
                    <a ng-if="modifyUser" class="btn btn-outline btn-cancel" ng-click="resetPassword()"><i class="fa fa-rotate-left"></i> Reset Password</a>
                </div>
            </form>
        </div>
    </div>

</div>